{% extends 'inicio.html' %}
{% load static %}

{% block contenido %}
<style>
    /* Estilos específicos para la página de perfil */
        body {
            background-color: #f8f9fa; /* Fondo ligeramente distinto para esta sección */
        }
        header nav a {
            margin-left: 15px;
            color: white;
            text-decoration: none;
            font-weight: 500;
        }
        .profile-card {
            background-color: #fff;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .profile-img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 50%;
            margin-bottom: 15px;
        }
        .btn-edit, .btn-primary {
            background-color: #D90429;
            border-color: #D90429;
            color: white;
        }
        .btn-edit:hover, .btn-primary:hover {
            background-color: #A9001F;
            border-color: #A9001F;
            color: white;
        }
</style>

<main class="container my-5">
    <div class="profile-card text-center">
        <!-- Encuestas Pendientes -->
        {% if encuestas_pendientes %}
        <div class="alert alert-info border-info border-2 text-start mb-4">
            <h4 class="alert-heading"><i class="bi bi-card-checklist me-2"></i>¡Tienes encuestas pendientes!</h4>
            <p>Tu opinión es importante para nosotros. Por favor, ayúdanos a mejorar respondiendo la siguiente encuesta:</p>
            <hr>
            {% for encuesta in encuestas_pendientes %}
            <form method="POST" class="mb-3">
                {% csrf_token %}
                <input type="hidden" name="encuesta_id" value="{{ encuesta.id }}">
                
                <p class="mb-2"><strong>{{ encuesta.titulo }}</strong> (Reunión: {{ encuesta.reunion.detalle }})</p>
                
                <div class="mb-2">
                    <label class="form-label">¿Qué tan satisfecho estás con la reunión?</label>
                    <div class="btn-group" role="group" aria-label="Puntuación">
                        {% for value, text in form_resp_encuesta.puntuacion.field.choices %}
                            <input type="radio" class="btn-check" name="puntuacion" id="id_puntuacion_{{ encuesta.id }}_{{ forloop.counter }}" value="{{ value }}" autocomplete="off">
                            <label class="btn btn-outline-primary" for="id_puntuacion_{{ encuesta.id }}_{{ forloop.counter }}">{{ value }} <i class="bi bi-star-fill"></i></label>
                        {% endfor %}
                    </div>
                </div>
                <div class="mb-3">
                    <label for="comentarios_{{ encuesta.id }}" class="form-label">Comentarios (opcional):</label>
                    <textarea name="comentarios" id="comentarios_{{ encuesta.id }}" class="form-control" rows="2"></textarea>
                </div>
                <button type="submit" name="responder_encuesta" class="btn btn-success">Enviar Respuesta</button>
            </form>
            {% if not forloop.last %}<hr>{% endif %}
            {% endfor %}
        </div>
        {% endif %}

        {% if usuario.foto %}
            <img src="{{ usuario.foto.url }}" alt="Avatar de {{ usuario.nombre }}" class="profile-img">
        {% else %}
            <img src="{% static 'img/persn.jpg' %}" alt="Avatar por defecto" class="profile-img">
        {% endif %}
        <h3>{{ usuario.nombre }} {{ usuario.apellido }}</h3>
        <p class="text-muted mb-1"><i class="bi bi-person-badge-fill me-1"></i>{{ usuario.get_rubro_real_display|default:"Sin rol especificado" }}</p>
        {% if usuario.carrera %}<p class="text-muted mb-1"><i class="bi bi-mortarboard-fill me-1"></i>{{ usuario.get_carrera_real_display }}</p>{% endif %}
        {% if usuario.sede %}<p class="text-muted mb-1"><i class="bi bi-building-fill me-1"></i>Sede {{ usuario.get_sede_real_display }}</p>{% endif %}
        <p class="text-muted mt-3"><i class="bi bi-envelope-fill me-1"></i>{{ usuario.email }} | <i class="bi bi-telephone-fill ms-2 me-1"></i>{{ usuario.telefono|default:"No especificado" }}</p>
        <p class="text-muted fw-bold"><i class="bi bi-calendar-check-fill me-1"></i>Reuniones Asistidas: {{ usuario.cantidad_asistencias }}</p>
        
        <!-- Botón de Editar Perfil -->
        <div class="mt-4">
            <a href="{% url 'editar_perfil' usuario.id %}" class="btn btn-edit"><i class="bi bi-pencil-square me-1"></i> Editar Perfil</a>
        </div>
    </div>

    <!-- Nueva sección de acciones de la cuenta -->
    <div class="card shadow-sm mt-4">
        <div class="card-body">
            <h5 class="card-title mb-3">Acciones de la Cuenta</h5>
            <div class="list-group">
                <a href="{% url 'mis_tickets' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-headset me-2 text-primary"></i>Mis Tickets</span>
                    <i class="bi bi-chevron-right"></i>
                </a>
                <a href="{% url 'configuracion' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-gear-fill me-2 text-secondary"></i>Configuración</span>
                    <i class="bi bi-chevron-right"></i>
                </a>
                <a href="{% url 'logout' %}" class="list-group-item list-group-item-action text-danger d-flex justify-content-between align-items-center">
                    <span><i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión</span>
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>
        </div>
    </div>

</main>

{% endblock contenido %}